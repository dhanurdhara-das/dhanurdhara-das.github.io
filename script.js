// Translations
const translations = {
    en: {
        lang: {
            english: 'English',
            portuguese: 'Português'
        },
        nav: {
            logo: 'Wellness Center',
            home: 'Home',
            about: 'Bhakti Marga',
            satguru: 'Satguru',
            bio: 'Bio',
            practices: 'Practices',
            contact: 'Contact'
        },
        home: {
            heroTitle: 'Welcome to Wellness Center',
            heroSubtitle: 'Your journey to wellness begins here',
            getStarted: 'Get Started',
            feature1Title: 'Holistic Approach',
            feature1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.',
            feature2Title: 'Natural Methods',
            feature2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.',
            feature3Title: 'Expert Care',
            feature3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.'
        },
        about: {
            title: 'Bhakti Marga',
            storyTitle: 'Our Story',
            story1: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.',
            story2: 'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
            story3: 'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.',
            valuesTitle: 'Our Values',
            value1Title: 'Compassion',
            value1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value2Title: 'Excellence',
            value2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value3Title: 'Integrity',
            value3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value4Title: 'Innovation',
            value4Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.'
        },
        bio: {
            title: 'Bio',
            name: 'Dhanurdhara Das Ananda',
            titleText: 'Teacher of Spiritual Knowledge, Rituals & Atma Kriya Yoga',
            text1: 'Born in July 1994, Dhanurdhara Das Ananda grew up in a religious family, yet he never considered himself a religious person. As a young man, after achieving many of the things he desired, he began to feel an inner emptiness he couldn\'t explain or fill.',
            text2: 'With his long-standing interest in history, politics, and philosophy, he turned his attention toward self-knowledge, God, and the depth of Hindu culture.',
            text3: 'In January 2017, he met Paramahamsa Vishwananda in São Paulo, where he experienced something profound and transformative — an encounter he later understood as a call from his soul to his Satguru.',
            text4: 'In Florianópolis, where he lived, Paramahamsa Vishwananda inaugurated a temple located just ten minutes from his home, which Dhanurdhara began to attend regularly. A year later, he traveled to Germany to Shree Peetha Nilaya, where he dedicated himself to seva (selfless service) and a deeper study of Bhakti Marga and Hinduism.',
            educationTitle: 'Education & Certifications',
            education1: 'Training in Bhakti Yoga and Vedic Philosophy, Bhakti Marga Academy',
            education2: 'Certified Atma Kriya Yoga Teacher',
            education3: 'Training in Vedic Rituals and Spiritual Ceremonies',
            education4: 'Ongoing studies under the guidance of Paramahamsa Vishwananda',
            experienceTitle: 'Experience',
            experienceText: 'With over seven years dedicated to the Bhakti path, Dhanurdhara Das Ananda serves as a teacher and facilitator of spiritual practices, offering classes and talks on Vedic knowledge, rituals, and Atma Kriya Yoga. His work inspires spiritual seekers to cultivate a deeper relationship with the Divine, integrating ancient wisdom with daily devotion and self-discovery.'
        },
        satguru: {
            title: 'Satguru',
            subtitle: 'Paramahamsa Vishwananda',
            text1: 'Paramahamsa Sri Swami Vishwananda (born 13 June 1978 in Beau Bassin–Rose Hill, Mauritius) is a Mauritian-born Hindu spiritual teacher and the founder of Bhakti Marga. His early life is presented by his organisation as steeped in devotion, with a formative encounter with Mahavatar Babaji in childhood—a relationship he describes as the guiding thread of his mission.',
            text2: 'After traveling and giving darshan in Europe in the late 1990s, he formally established Bhakti Marga on 13 June 2005. The movement\'s international headquarters is Shree Peetha Nilaya in Heidenrod (Taunus), Germany, from which he teaches a path of devotion (bhakti), including practices such as Atma Kriya Yoga.',
            text3: 'In recent years, he articulated the Hari Bhakta Sampradaya within which Bhakti Marga operates, and the mission has grown to include temples and centers worldwide.'
        },
        practices: {
            title: 'Our Practices',
            practice1Title: 'Acupuncture',
            practice1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice2Title: 'Yoga Therapy',
            practice2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice3Title: 'Reiki Healing',
            practice3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice4Title: 'Meditation',
            practice4Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice5Title: 'Herbal Medicine',
            practice5Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice6Title: 'Nutrition Counseling',
            practice6Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            learnMore: 'Learn More →'
        },
        booking: {
            title: 'Contact',
            nameLabel: 'Full Name',
            emailLabel: 'Email',
            phoneLabel: 'Phone',
            dateLabel: 'Preferred Date',
            timeLabel: 'Preferred Time',
            messageLabel: 'Message (Optional)',
            submitButton: 'Send Message'
        },
        footer: {
            text: 'Wellness Center. All rights reserved.'
        },
        messages: {
            bookingSuccess: 'Thank you for your message! We will contact you soon.'
        }
    },
    pt: {
        lang: {
            english: 'English',
            portuguese: 'Português'
        },
        nav: {
            logo: 'Centro de Bem-Estar',
            home: 'Início',
            about: 'Bhakti Marga',
            satguru: 'Satguru',
            bio: 'Biografia',
            practices: 'Práticas',
            contact: 'Contato'
        },
        home: {
            heroTitle: 'Bem-vindo ao Centro de Bem-Estar',
            heroSubtitle: 'Sua jornada para o bem-estar começa aqui',
            getStarted: 'Começar',
            feature1Title: 'Abordagem Holística',
            feature1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.',
            feature2Title: 'Métodos Naturais',
            feature2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.',
            feature3Title: 'Cuidado Especializado',
            feature3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.'
        },
        about: {
            title: 'Bhakti Marga',
            storyTitle: 'Nossa História',
            story1: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.',
            story2: 'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
            story3: 'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.',
            valuesTitle: 'Nossos Valores',
            value1Title: 'Compaixão',
            value1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value2Title: 'Excelência',
            value2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value3Title: 'Integridade',
            value3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.',
            value4Title: 'Inovação',
            value4Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit.'
        },
        bio: {
            title: 'Biografia',
            name: 'Dhanurdhara Das Ananda',
            titleText: 'Professor de Conhecimento Espiritual, Rituais & Atma Kriya Yoga',
            text1: 'Nascido em julho de 1994, Dhanurdhara Das Ananda cresceu em uma família religiosa, mas nunca se considerou uma pessoa religiosa. Ainda jovem, após conquistar o que desejava materialmente, começou a sentir um vazio interior que não sabia como preencher.',
            text2: 'Movido por um interesse crescente por história, política e filosofia, iniciou uma busca mais profunda por autoconhecimento, espiritualidade e pela compreensão de Deus — caminho que o levou à cultura hindu.',
            text3: 'Em janeiro de 2017, conheceu Paramahamsa Vishwananda em São Paulo. Durante esse encontro, viveu uma experiência profunda e transformadora, que mais tarde reconheceu como um chamado da alma ao seu Satguru.',
            text4: 'Em Florianópolis, cidade onde residia, Paramahamsa Vishwananda inaugurou um templo a apenas dez minutos de sua casa, e Dhanurdhara passou a frequentá-lo regularmente. Um ano depois, viajou à Alemanha, ao ashram Shree Peetha Nilaya, onde se dedicou ao seva (serviço devocional) e ao aprendizado mais profundo sobre Bhakti Marga e o Hinduísmo.',
            educationTitle: 'Educação e Certificações',
            education1: 'Formação em Bhakti Yoga e Filosofia Védica, Bhakti Marga Academy',
            education2: 'Instrutor Certificado de Atma Kriya Yoga',
            education3: 'Formação em Rituais Védicos e Cerimônias Espirituais',
            education4: 'Estudos contínuos sob a orientação de Paramahamsa Vishwananda',
            experienceTitle: 'Experiência',
            experienceText: 'Com mais de sete anos dedicados ao caminho do Bhakti, Dhanurdhara Das Ananda atua como professor e facilitador de práticas espirituais, conduzindo aulas e palestras sobre conhecimento védico, rituais e Atma Kriya Yoga. Seu trabalho inspira buscadores espirituais a desenvolver uma relação mais profunda com o Divino, unindo sabedoria ancestral e prática devocional no cotidiano.'
        },
        satguru: {
            title: 'Satguru',
            subtitle: 'Paramahamsa Vishwananda',
            text1: 'Paramahamsa Sri Swami Vishwananda (nascido em 13 de junho de 1978, em Beau Bassin–Rose Hill, Maurício) é um mestre espiritual hindu nascido no Maurício e fundador da Bhakti Marga. Sua organização apresenta sua infância como profundamente devocional, marcada por um encontro formativo com Mahavatar Babaji — relação que ele descreve como o fio condutor de sua missão.',
            text2: 'Após viajar e oferecer darshan na Europa no fim dos anos 1990, ele fundou oficialmente a Bhakti Marga em 13 de junho de 2005. A sede internacional do movimento é Shree Peetha Nilaya, em Heidenrod (Taunus), Alemanha, de onde ele ensina um caminho de devoção (bhakti), incluindo práticas como Atma Kriya Yoga.',
            text3: 'Nos últimos anos, ele apresentou a Hari Bhakta Sampradaya, dentro da qual a Bhakti Marga opera, e a missão tem se expandido, passando a incluir templos e centros no mundo todo.'
        },
        practices: {
            title: 'Nossas Práticas',
            practice1Title: 'Acupuntura',
            practice1Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice2Title: 'Terapia de Yoga',
            practice2Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice3Title: 'Cura Reiki',
            practice3Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice4Title: 'Meditação',
            practice4Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice5Title: 'Medicina Herbal',
            practice5Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            practice6Title: 'Aconselhamento Nutricional',
            practice6Text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.',
            learnMore: 'Saiba Mais →'
        },
        booking: {
            title: 'Contato',
            nameLabel: 'Nome Completo',
            emailLabel: 'Email',
            phoneLabel: 'Telefone',
            dateLabel: 'Data Preferida',
            timeLabel: 'Horário Preferido',
            messageLabel: 'Mensagem (Opcional)',
            submitButton: 'Enviar Mensagem'
        },
        footer: {
            text: 'Centro de Bem-Estar. Todos os direitos reservados.'
        },
        messages: {
            bookingSuccess: 'Obrigado pela sua mensagem! Entraremos em contato em breve.'
        }
    }
};

// Current language
let currentLang = localStorage.getItem('language') || 'en';

// Translation function
function translate(key) {
    const keys = key.split('.');
    let value = translations[currentLang];
    for (const k of keys) {
        value = value?.[k];
    }
    return value || key;
}

// Update page language
function updateLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
    
    // Update all elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        const translation = translate(key);
        
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = translation;
        } else if (element.tagName === 'OPTION') {
            element.textContent = translation;
        } else {
            element.textContent = translation;
        }
    });
    
    // Update language dropdown display
    const dropdown = document.getElementById('language-dropdown');
    const selectedDisplay = document.getElementById('dropdown-selected');
    if (dropdown && selectedDisplay) {
        const selectedOption = dropdown.querySelector(`[data-lang="${lang}"]`);
        if (selectedOption) {
            const flag = selectedOption.querySelector('.flag').textContent;
            const langName = selectedOption.querySelector('.lang-name').textContent;
            selectedDisplay.querySelector('.flag').textContent = flag;
            selectedDisplay.querySelector('.lang-name').textContent = langName;
        }
    }
}

// Navigation functionality
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page');
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('.nav-menu');

    // Handle navigation clicks
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            
            // Remove active class from all links and pages
            navLinks.forEach(l => l.classList.remove('active'));
            pages.forEach(p => p.classList.remove('active'));
            
            // Add active class to clicked link and target page
            this.classList.add('active');
            const targetPage = document.getElementById(targetId);
            if (targetPage) {
                targetPage.classList.add('active');
                
                // Smooth scroll to top
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
            
            // Close mobile menu
            navMenu.classList.remove('active');
        });
    });

    // Hamburger menu toggle
    hamburger.addEventListener('click', function() {
        navMenu.classList.toggle('active');
        this.classList.toggle('active');
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
        if (!hamburger.contains(e.target) && !navMenu.contains(e.target)) {
            navMenu.classList.remove('active');
            hamburger.classList.remove('active');
        }
    });

    // Set initial active page based on hash or default to home
    const hash = window.location.hash.substring(1);
    if (hash && document.getElementById(hash)) {
        navLinks.forEach(l => l.classList.remove('active'));
        pages.forEach(p => p.classList.remove('active'));
        document.querySelector(`a[href="#${hash}"]`).classList.add('active');
        document.getElementById(hash).classList.add('active');
    }

    // Handle browser back/forward buttons
    window.addEventListener('hashchange', function() {
        const hash = window.location.hash.substring(1);
        if (hash && document.getElementById(hash)) {
            navLinks.forEach(l => l.classList.remove('active'));
            pages.forEach(p => p.classList.remove('active'));
            document.querySelector(`a[href="#${hash}"]`).classList.add('active');
            document.getElementById(hash).classList.add('active');
        }
    });

    // Form submission
    const bookingForm = document.querySelector('.booking-form');
    if (bookingForm) {
        bookingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Show success message (in a real app, you'd send this to a server)
            alert(translate('messages.bookingSuccess'));
            
            // Reset form
            this.reset();
        });
    }

    // Add scroll effect to navbar
    let lastScroll = 0;
    const navbar = document.querySelector('.navbar');
    
    window.addEventListener('scroll', function() {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll > 100) {
            navbar.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.15)';
        } else {
            navbar.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.1)';
        }
        
        lastScroll = currentScroll;
    });

    // Intersection Observer for fade-in animations on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe elements for scroll animations
    const animateElements = document.querySelectorAll('.feature-card, .practice-card, .value-item');
    animateElements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });

    // Smooth reveal for images
    const images = document.querySelectorAll('img');
    images.forEach(img => {
        img.addEventListener('load', function() {
            this.style.opacity = '1';
        });
    });

    // Custom language dropdown functionality
    const dropdown = document.getElementById('language-dropdown');
    const selectedDisplay = document.getElementById('dropdown-selected');
    const dropdownOptions = document.getElementById('dropdown-options');
    
    if (dropdown && selectedDisplay && dropdownOptions) {
        // Toggle dropdown on click
        selectedDisplay.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdown.classList.toggle('active');
        });
        
        // Handle option selection
        const options = dropdownOptions.querySelectorAll('.dropdown-option');
        options.forEach(option => {
            option.addEventListener('click', function(e) {
                e.stopPropagation();
                const lang = this.getAttribute('data-lang');
                updateLanguage(lang);
                dropdown.classList.remove('active');
            });
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('active');
            }
        });
    }

    // Initialize language on page load
    updateLanguage(currentLang);

    // Satguru Carousel functionality
    const satguruCarousel = document.querySelector('.satguru-carousel-container');
    if (satguruCarousel) {
        const carouselTrack = satguruCarousel.querySelector('.carousel-track');
        const carouselSlides = satguruCarousel.querySelectorAll('.carousel-slide');
        const prevBtn = satguruCarousel.querySelector('.carousel-btn-prev');
        const nextBtn = satguruCarousel.querySelector('.carousel-btn-next');
        const dots = satguruCarousel.querySelectorAll('.carousel-dot');
        
        if (carouselTrack && carouselSlides.length > 0) {
            let currentIndex = 0;
            const totalSlides = carouselSlides.length;
            const slidesToShow = 3; // Show 3 images at once
            
            function getSlidesToShow() {
                if (window.innerWidth <= 768) {
                    return 1; // Show 1 image on mobile
                } else if (window.innerWidth <= 1024) {
                    return 2; // Show 2 images on tablet
                }
                return 3; // Show 3 images on desktop
            }
            
            function updateCarousel() {
                const visibleSlides = getSlidesToShow();
                const containerWidth = carouselTrack.parentElement.offsetWidth;
                const gap = 16; // 1rem gap
                const slideWidth = (containerWidth - (visibleSlides - 1) * gap) / visibleSlides;
                const translateX = currentIndex * (slideWidth + gap);
                carouselTrack.style.transform = `translateX(-${translateX}px)`;
                
                // Update dots
                const maxIndex = Math.max(0, totalSlides - visibleSlides);
                const dotIndex = Math.floor(currentIndex / visibleSlides);
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === dotIndex);
                });
            }
            
            function nextSlide() {
                const visibleSlides = getSlidesToShow();
                const maxIndex = Math.max(0, totalSlides - visibleSlides);
                if (currentIndex < maxIndex) {
                    currentIndex += visibleSlides;
                } else {
                    currentIndex = 0; // Loop back to start
                }
                updateCarousel();
            }
            
            function prevSlide() {
                const visibleSlides = getSlidesToShow();
                if (currentIndex > 0) {
                    currentIndex -= visibleSlides;
                } else {
                    const maxIndex = Math.max(0, totalSlides - visibleSlides);
                    currentIndex = maxIndex; // Loop to end
                }
                updateCarousel();
            }
            
            function goToSlide(dotIndex) {
                const visibleSlides = getSlidesToShow();
                currentIndex = dotIndex * visibleSlides;
                const maxIndex = Math.max(0, totalSlides - visibleSlides);
                if (currentIndex > maxIndex) {
                    currentIndex = maxIndex;
                }
                updateCarousel();
            }
            
            // Event listeners
            if (nextBtn) {
                nextBtn.addEventListener('click', nextSlide);
            }
            
            if (prevBtn) {
                prevBtn.addEventListener('click', prevSlide);
            }
            
            // Dot navigation
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => goToSlide(index));
            });
            
            // Touch/swipe support for mobile
            let startX = 0;
            let endX = 0;
            
            carouselTrack.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
            });
            
            carouselTrack.addEventListener('touchend', (e) => {
                endX = e.changedTouches[0].clientX;
                handleSwipe();
            });
            
            function handleSwipe() {
                const diff = startX - endX;
                if (Math.abs(diff) > 50) { // Minimum swipe distance
                    if (diff > 0) {
                        nextSlide();
                    } else {
                        prevSlide();
                    }
                }
            }
            
            // Recalculate on window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    const visibleSlides = getSlidesToShow();
                    const maxIndex = Math.max(0, totalSlides - visibleSlides);
                    if (currentIndex > maxIndex) {
                        currentIndex = maxIndex;
                    }
                    updateCarousel();
                }, 250);
            });
            
            // Initialize carousel
            updateCarousel();
        }
    }
});

